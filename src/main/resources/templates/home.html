<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <title>HOME</title>

    <script type="text/javascript">
        async function logout() {
            const xsrfToken = document.cookie.replace(/(?:(?:^|.*;\s*)XSRF-TOKEN\s*\=\s*([^;]*).*$)|^.*$/, '$1');

            try {
                const response = await fetch('/member/logout', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                        'X-XSRF-TOKEN': xsrfToken
                    }
                });

                if (response.ok) {
                    window.location.href = '/';
                } else {
                    console.error('Logout failed', response);
                }
            } catch (error) {
                console.error('Error during logout', error);
            }
        }
    </script>
</head>

<body>
<h1>홈</h1>
<div sec:authorize="isAnonymous()">
    <a th:href="@{/member/new}">회원가입</a>
    <a th:href="@{/member/login}">로그인</a>
</div>
<div sec:authorize="isAuthenticated()">
    <table>
        <tr>
            <td>name</td>
            <td><span sec:authentication="name"></span></td>
        </tr>
        <tr>
            <td>username</td>
            <td><span sec:authentication="principal.username"></span></td>
        </tr>
        <tr>
            <td>id</td>
            <td><span sec:authentication="principal.id"></span></td>
        </tr>
    </table>

    <a th:href="@{/member/update}">회원수정</a>
    <a th:href="@{/member/logout}">회원수정</a>
</div>

</body>
</html>
